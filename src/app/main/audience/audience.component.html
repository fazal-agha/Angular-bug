<h1 class="m-t-0 m-b-20 fs-24 fw-600 m-r-22">
  Audience
</h1>
<div class="df jc-b m-b-15">
  <div class="df">
    <div class="pos-r m-r-9">
      <input
        [(ngModel)]="searchText"
        (ngModelChange)="filterCampaigns()"
        style="width: 235px;"
        placeholder="Search By Campaign"
        class="small"
        type="text"
        nbInput
        fullWidth
        fieldSize="small"
      />
      <div class="input-icon">
        <img src="assets/svg-icon/search-outline.svg" alt="" />
      </div>
    </div>
    <!-- <div class="filtr-btn pos-r" style="top: -5px">
      <img src="assets/img/filtre.png" alt="" />
    </div> -->
    <nb-select (selectedChange)="onChangeTab()" [(ngModel)]="type" style="width: 300px" size="small" placeholder="Select campaign type">
      <nb-option [value]="'coupons'">Coupons</nb-option>
      <nb-option [value]="'tickets'">Tickets</nb-option>
      <nb-option [value]="'stamp_cards'">Stamp Cards</nb-option>
      <nb-option [value]="'loyalty_cards'">Loyalty Cards</nb-option>
      <nb-option [value]="'membership_cards'">Membership Cards</nb-option>
    </nb-select>
  </div>
  <div>
    <div *ngIf="type === 'coupons'">
      {{selectedAudience.length}} selected of {{filterCouponAudience.length}} total
    </div>
    <div *ngIf="type === 'stamp_cards'">
      {{selectedAudience.length}} selected of {{filterstampCardAudience.length}} total
    </div>
    <div *ngIf="type === 'tickets'">
      {{selectedAudience.length}} selected of {{filterTicketAudience.length}} total
    </div>
    <div *ngIf="type === 'loyalty_cards'">
      {{selectedAudience.length}} selected of {{filterloyaltyCardAudience.length}} total
    </div>
    <div *ngIf="type === 'membership_cards'">
      {{selectedAudience.length}} selected of {{filterMembershipCardAudience.length}} total
    </div>
  </div>
</div>
<nb-card>
  <nb-card-body>
      <div *ngIf="showLoader" class="loader-table m-t-50">
        <img width="70px" src="assets/img/Loader2x.gif" alt="">
      </div>
      <div *ngIf=!showLoader class="check-all-wrap">
          <div (click)=download() class="invite download m-t-14 m-b-12 ml-auto">
            <img src="assets/img/d-icon.png" width="14px" alt="">
            Download CSV
          </div>
          <div (click)="refresh()" class="refresh m-t-14 m-b-12 m-l-10">
            <img src="assets/svg-icon/refresh-Btn.svg" alt="">
            Refresh
          </div>
      </div>
      <div class="box-container" *ngIf="!showLoader">

        <!-- Coupon Table -->

        <table *ngIf="type === 'coupons'" class="m-b-40 full-width" [nbTreeGrid]="filterCouponAudience">
          <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allCouponColumns"></tr>
          <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allCouponColumns"></tr>

          <ng-container
            *ngFor="let column of couponColumns"
            [nbTreeGridColumnDef]="column"
          >
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
              <span *ngIf="column !== 'Check'">
                {{column}}
              </span>
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="checkAllcoupons" (change)="selectAll()"></nb-checkbox>
              </div>
            </th>
            <td
              [ngClass]="{'check-row-bg': row.data['Check'].name}"
              nbTreeGridCell
              *nbTreeGridCellDef="let row; index as i"
            >

              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="row.data[column].name" (change)="select()"></nb-checkbox>
              </div>
              <div class="df ai-c">
                <div class="df ai-c m-r-4">
                  <span *ngIf="column === 'Type'">
                    <img class="m-r-8" [src]="row.data[column].icon" alt="" />
                  </span>
                </div>
                <div class="ellipsis" *ngIf="column !== 'Status' &&  column !== 'Type' && column !== 'Check' && column !== 'Days Left'">
                  <span>{{ row.data[column].name }}</span>
                </div>
                <div *ngIf="column === 'Days Left'">
                  <span [ngClass]="{expired: row.data[column].name === 'Expired'}">
                    {{ row.data[column].name }}
                  </span>
                </div>
              </div>
              <div *ngIf="column === 'Status'">
                <span
                  class="status"
                  [ngClass]="{
                    used: row.data[column].name === 'Used',
                    unused: row.data[column].name === 'Unused',
                    expired: row.data[column].name === 'Expired'
                  }"
                >
                  <img
                    class="m-r-3"
                    width="12px"
                    *ngIf="row.data[column].name === 'Used'"
                    src="assets/img/success-white.png"
                    alt=""
                  />
                  {{ row.data[column].name }}
                </span>
              </div>
            </td>
          </ng-container>
        </table>

        <!-- Ticket Table -->

        <table *ngIf="type === 'tickets'" class="m-b-40 full-width" [nbTreeGrid]="filterTicketAudience">
          <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="alleventColumns"></tr>
          <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: alleventColumns"></tr>

          <ng-container
            *ngFor="let column of eventColumns"
            [nbTreeGridColumnDef]="column"
          >
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
              <span *ngIf="column !== 'Check'">
                {{column}}
              </span>
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="checkAlltickets" (change)="selectAll()"></nb-checkbox>
              </div>
            </th>
            <td
              [ngClass]="{'check-row-bg': row.data['Check'].name}"
              nbTreeGridCell
              *nbTreeGridCellDef="let row; index as i"
            >
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="row.data[column].name" (change)="select()"></nb-checkbox>
              </div>
              <div class="df ai-c">
                <div class="df ai-c m-r-4">
                  <span *ngIf="column === 'Type'">
                    <img class="m-r-8" [src]="row.data[column].icon" alt="" />
                  </span>
                </div>
                <div class="ellipsis">
                  <span *ngIf="column !== 'Members' && column !== 'Type' && column !== 'Check in' && column !== 'Check'">
                    {{ row.data[column].name }}</span>
                </div>
              </div>
              <div *ngIf="column === 'Check in'">
                  <span *ngIf="row.data[column].name === true">
                    <div class=circle-active></div>
                  </span>
                  <span *ngIf="row.data[column].name === false">
                    <div class=circle-inactive></div>
                  </span>
                </div>
              <div class=text-center>
                <span *ngIf="column === 'Members'">{{ row.data[column].name }}</span>
              </div>
            </td>
          </ng-container>
        </table>

        <!-- Stamp Cards Table -->

        <table *ngIf="type === 'stamp_cards'" class="m-b-40 full-width" [nbTreeGrid]="filterstampCardAudience">
          <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allstampCardColumns"></tr>
          <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allstampCardColumns"></tr>

          <ng-container
            *ngFor="let column of stampCardColumns"
            [nbTreeGridColumnDef]="column"
          >
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
              <span *ngIf="column !== 'Check'">
                {{column}}
              </span>
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="checkAllStampCards" (change)="selectAll()"></nb-checkbox>
              </div>
            </th>
            <td
              [ngClass]="{'check-row-bg': row.data['Check'].name}"
              nbTreeGridCell
              *nbTreeGridCellDef="let row; index as i"
            >
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="row.data[column].name" (change)="select()"></nb-checkbox>
              </div>
              <div class="df ai-c">
                <div class="ellipsis">
                  <span *ngIf="column !== 'Check'">{{ row.data[column].name }}</span>
                </div>
              </div>
            </td>
          </ng-container>
        </table>

        <!-- Loyalty Cards Table -->

        <table *ngIf="type === 'loyalty_cards'" class="m-b-40 full-width" [nbTreeGrid]="filterloyaltyCardAudience">
          <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allLoyaltyCardColumns"></tr>
          <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allLoyaltyCardColumns"></tr>

          <ng-container
            *ngFor="let column of loyaltyCardColumns"
            [nbTreeGridColumnDef]="column"
          >
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
              <span *ngIf="column !== 'Check'">
                {{column}}
              </span>
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="checkAllLoyaltyCards" (change)="selectAll()"></nb-checkbox>
              </div>
            </th>
            <td
              [ngClass]="{'check-row-bg': row.data['Check'].name}"
              nbTreeGridCell
              *nbTreeGridCellDef="let row; index as i"
            >
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="row.data[column].name" (change)="select()"></nb-checkbox>
              </div>

              <div class="df ai-c">
                <div class="ellipsis">
                  <span *ngIf="column !== 'Check'">{{ row.data[column].name }}</span>
                </div>
              </div>
            </td>
          </ng-container>
        </table>

        <!-- Membership Card Table -->

        <table *ngIf="type === 'membership_cards'" class="m-b-40 full-width" [nbTreeGrid]="filterMembershipCardAudience">
          <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allMembershipCardColumns"></tr>
          <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allMembershipCardColumns"></tr>

          <ng-container
            *ngFor="let column of membershipCardColumns"
            [nbTreeGridColumnDef]="column"
          >
            <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>
              <span *ngIf="column !== 'Check'">
                {{column}}
              </span>
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="checkAllMembershipCards" (change)="selectAll()"></nb-checkbox>
              </div>
            </th>
            <td
              [ngClass]="{'check-row-bg': row.data['Check'].name}"
              nbTreeGridCell
              *nbTreeGridCellDef="let row; index as i"
            >
              <div *ngIf="column === 'Check'">
                <nb-checkbox [(ngModel)]="row.data[column].name" (change)="select()"></nb-checkbox>
              </div>
              <div class="df ai-c">
                <div class="ellipsis" *ngIf="column !== 'Status' &&  column !== 'Check'">
                  <span>{{ row.data[column].name }}</span>
                </div>
                <span *ngIf="column === 'Status'">
                  <label class="switch"
                    (click)="changeMembershipCardStatus(
                    $event.target,
                    'check-' + row.data['Id'].name,
                    row.data['Id'].name,
                    $event)">
                    <input *ngIf="row.data['Status'].name" id="{{ 'check-' + row.data['Id'].name  }}" type="checkbox" checked disabled>
                    <input *ngIf="!row.data['Status'].name" id="{{ 'check-' + row.data['Id'].name  }}" type="checkbox" disabled>
                    <span class="slider round"></span>
                  </label>
                </span>
              </div>
            </td>
          </ng-container>
        </table>

        <div *ngIf="
          (type === 'coupons' && !CouponAudience.length) ||
          (type === 'tickets' && !TicketAudience.length) ||
          (type === 'stamp_cards' && !stampCardAudience.length) ||
          (type === 'loyalty_cards' && !loyaltyCardAudience.length) ||
          (type === 'membership_cards' && !membershipCardAudience.length)" class="create-btn-wrap">
          <img class="m-b-16 m-t-40" src="assets/svg-icon/noAudience.svg" alt="">
          <div class="m-b-25 fs-22">
            No Audience!
          </div>
        </div>
      </div>



  </nb-card-body>
</nb-card>
<div *ngIf="showActions" (click)="showActions = null" class="close-bg"></div>

<!-- <table *ngIf="data.length" class="m-b-40 full-width" [nbTreeGrid]="data">
              <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allCouponColumns"></tr>
              <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allCouponColumns"></tr>

              <ng-container
                *ngFor="let column of couponColumns"
                [nbTreeGridColumnDef]="column"
              >
                <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>{{ column }}</th>
                <td
                  (click)="selectedSell = row.data[column].name"
                  [ngClass]="{ 'active-sell': selectedSell === row.data[column].name }"
                  nbTreeGridCell
                  *nbTreeGridCellDef="let row"
                >
                  <div class="df ai-c">
                    <div class="df ai-c m-r-4">
                      <span *ngIf="column === 'Type'">
                        <img class="m-r-8" [src]="row.data[column].icon" alt="" />
                      </span>
                    </div>
                    <div class="ellipsis" *ngIf="column !== 'Status'">
                      <span>{{ row.data[column].name }}</span>
                    </div>
                  </div>
                  <div *ngIf="column === 'Status'">
                    <span
                      class="status"
                      [ngClass]="{
                        used: row.data[column].name === 'Used',
                        unused: row.data[column].name === 'Unused',
                        expired: row.data[column].name === 'Expired'
                      }"
                    >
                      <img
                        class="m-r-3"
                        width="12px"
                        *ngIf="row.data[column].name === 'Used'"
                        src="assets/img/success-white.png"
                        alt=""
                      />
                      {{ row.data[column].name }}
                    </span>
                  </div>
                </td>
              </ng-container>
            </table> -->
