<div class="df jc-b m-b-15">
  <h1 class="m-t-0 m-b-0 fs-24 fw-600">
    <span *ngIf="!id">Create Campaign</span>
    <span *ngIf="id">Edit Campaign</span>
  </h1>
</div>
<nb-card>
  <nb-card-header class="non-border">What is your Marketing Objective</nb-card-header>
  <nb-card-body *ngIf="showLoader">
    <div class="loader-table">
      <img width="70px" src="assets/img/Loader2x.gif" alt="">
    </div>
  </nb-card-body>
  <nb-card-body *ngIf="!showLoader" class="p-0 p-b-10">
    <table class="m-b-40" [nbTreeGrid]="data" equalColumnsWidth>
      <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allColumns"></tr>
      <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allColumns"></tr>

      <ng-container *ngFor="let column of defaultColumns" [nbTreeGridColumnDef]="column">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>{{column}}</th>
        <td [id]="row.data[column].name" (click)="selectType(row.data[column].name)"
          [ngClass]="{'active-sell': (selectedSell === row.data[column].name && row.data[column].name), 'c-p': row.data[column].name, 'pe-n': !row.data[column].name,
                       'disable': (disable && row.data[column].type != cardType) }"
          nbTreeGridCell *nbTreeGridCellDef="let row" [ngStyle]="{'pointer-events': row.data[column].locked ? 'none' : 'auto'}">
          <div class="df ai-c">
            <img *ngIf="selectedSell === row.data[column].name" class="m-r-15" width="30px"
              src="assets/svg-icon/success-circle.svg" alt="">
            <img *ngIf="selectedSell !== row.data[column].name" class="m-r-15" width="30px"
              [src]="row.data[column].icon" alt="">
            <span>{{row.data[column].name}}</span>
            <img *ngIf="row.data[column].locked == true" src="assets/img/lockIcon.png" alt=""
            style="margin-left: auto">
          </div>
        </td>
      </ng-container>
    </table>
    <div *ngIf="cardType === 'coupon' && selectedSell">
      <form [formGroup]="myForm">
        <div class="p-l-30 m-b-30" style="font-size: 25px">
          Campaign
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Campaign Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': myForm.controls['campaignName'].invalid && !customValidation}"
                  formControlName="campaignName" type="text" [(ngModel)]="dataCampaign.name" nbInput fullWidth
                  fieldSize="small" placeholder="">
                <div *ngIf="myForm.controls['campaignName'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Description
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <textarea [ngClass]="{'error': myForm.controls['description'].invalid && !customValidation}"
                  formControlName="description" [(ngModel)]="dataCampaign.description" nbInput fullWidth
                  placeholder="Textarea"></textarea>
                <div *ngIf="myForm.controls['description'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Template
            </div>
            <div class="value">
              <div *ngIf="coupons.length" class="pos-r full-width">
                <nb-select [ngClass]="{'error': myForm.controls['template'].invalid && !customValidation}"
                  formControlName="template" #selectTemplate size="small" placeholder="Select Template"
                  [(selected)]="dataCampaign.card_id">
                  <nb-option *ngFor="let item of coupons" [value]="item.id">
                    {{ item.template_name }}
                  </nb-option>
                </nb-select>
              </div>
              <div *ngIf="myForm.controls['template'].invalid && !customValidation" class="error-lable">
                Field error (make your choice)
              </div>
              <div *ngIf="noCoupons" class="error-lable fs-16">
                Please create Coupon Template First
                <a [routerLink]="[ '/main/templates/create-cards' ]" class="c-p">
                  (click here)
                </a>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Start Date
            </div>
            <div class="value df ai-c">
              <div (clickOutside)="showDatePicker = false" class="pos-r m-r-34">
                <input [ngClass]="{'error': !dataCampaign.startDate && !customValidation}" formControlName="startDate"
                  class="small" (focus)="showDatePicker = true" [(ngModel)]="dataCampaign.startDate" type="text" nbInput
                  fullWidth fieldSize="small" placeholder="">
                <div *ngIf="!dataCampaign.startDate && !customValidation" class="error-lable">
                  Field error (make your choice)
                </div>
                <nb-calendar *ngIf="showDatePicker" (dateChange)="dateStartChange($event);" [(date)]="dateStart">
                </nb-calendar>
              </div>
              <div class="pos-r df">
                <div class="m-r-13 p-t-10">
                  End Date
                </div>
                <div (clickOutside)="showDatePickerEnd = false" class="pos-r">
                  <input [ngClass]="{'error': !dataCampaign.endDate && !customValidation}" formControlName="endDate"
                    class="small" (focus)="showDatePickerEnd = true" [(ngModel)]="dataCampaign.endDate" type="text" nbInput
                    fullWidth fieldSize="small" placeholder="">
                  <div *ngIf="!dataCampaign.endDate && !customValidation" class="error-lable">
                    Field error (make your choice)
                  </div>
                  <nb-calendar *ngIf="showDatePickerEnd" (dateChange)="dateEndChange($event);" [(date)]="dateEnd">
                  </nb-calendar>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Coupon
        </div>
        <div class="p-l-60">
          <div class="row-input" style="display: none !important;">
            <div class="lable">
              Select Currency
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select [ngClass]="{'error': myForm.controls['currency'].invalid && !customValidation}" formControlName="currency" [(ngModel)]="brand_currency" placeholder="" fullWidth fieldSize="small" style="width: 160px;">
                  <nb-option value="$">USD ($)</nb-option>
                  <nb-option value="€">EUR (€)</nb-option>
                  <nb-option value="£">GBP (£)</nb-option>
                  <nb-option value="$">AUD ($)</nb-option>
                  <nb-option value="$">CAD ($)</nb-option>
                  <nb-option value="R$">BRL (R$)</nb-option>
                  <nb-option value="HK$">HKD (HK$)</nb-option>
                  <nb-option value="лв">BGN (лв)</nb-option>
                  <nb-option value="₺">TRY (₺)</nb-option>
                  <nb-option value="د.إ">AED (د.إ)</nb-option>
                  <nb-option value="CHF">CHF (CHF)</nb-option>
                  <nb-option value="kr">SEK (kr)</nb-option>
                  <nb-option value="NT$">NT (NT$)</nb-option>
                  <nb-option value="R">ZAR (R)</nb-option>
                  <nb-option value="$">SGD ($)</nb-option>
                  <nb-option value="₩">KRW (₩)</nb-option>
                  <nb-option value="Rs">LKR (Rs)</nb-option>
                  <nb-option value="kr">DKK (kr)</nb-option>
                  <nb-option value="Rs">PKR (Rs)</nb-option>
                  <nb-option value="₾">GEL (₾)</nb-option>
                  <nb-option value="₽">RUB (₽)</nb-option>
                  <nb-option value="zł">PLN (zł)</nb-option>
                  <nb-option value="kr">SEK (kr)</nb-option>
                  <nb-option value="¥">CNY (¥)</nb-option>
                  <nb-option value="kr">NOK (kr)</nb-option>
                  <nb-option value="₹">INR (₹)</nb-option>
                  <nb-option value="$">NZD ($)</nb-option>
                  <nb-option value="RM">MYR (RM)</nb-option>
                  <nb-option value="฿">THB (฿)</nb-option>
                  <nb-option value="₫">VND (₫)</nb-option>
                </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Discount
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input id="discountInput" [ngClass]="{'error': myForm.controls['discount'].invalid && !customValidation}"
                  formControlName="discount" [ngModel]="dataCampaign.discount" (ngModelChange)="changeDiscount($event)"
                  class="small p-r-25" (input)="checkDiscount($event.target.value)" type="number" nbInput fullWidth fieldSize="small"
                  style="background-repeat: no-repeat; background-position: right;">
                <div *ngIf="myForm.controls['discount'].invalid && !customValidation" class="error-lable">
                  set discount
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="row-input">
            <div class="lable">
              Set Limit
            </div>
            <div class="value">
              <div class="pos-r">
                <input placeholder="Optional"
                  [ngClass]="{'error': myForm.controls['setLimit'].invalid && !customValidation}"
                  formControlName="setLimit" class="small" [(ngModel)]="limit" (ngModelChange)="onChange()" max="100"
                  type="number" nbInput fullWidth fieldSize="small" placeholder="">
                <div *ngIf="myForm.controls['setLimit'].invalid && !customValidation" class="error-lable">
                  set maximum number of coupons that can be created
                </div>
              </div>
            </div>
          </div> -->
          <div class="row-input">
            <div class="lable">
              Coupon Lifetime (Days)
            </div>
            <div class="value">
              <div class="pos-r">
                <input [ngClass]="{'error': myForm.controls['validity'].invalid && !customValidation}" (input)="checkValidity($event.target.value)"
                formControlName="validity" [(ngModel)]="dataCampaign.coupon_validity" type="text" class="small" nbInput fullWidth fieldSize="small" placeholder="">
                <div *ngIf="myForm.controls['validity'].invalid && !customValidation" class="error-lable">
                  Enter Validity in days e.g. 30 (1-365)
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Redemption
          <div style="font-size: small; padding-top: 5px;">
            (custom field triggers redemption flow)
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-60">
          <div class="row-input">
            <div class="lable p-t-0">
              Manychat CustomField
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFields" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  myForm.controls['customFields'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.selectedCustomField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Finance Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldFinance" size="small" placeholder="Select Finance Field"
                [ngClass]="{
                  error:
                  myForm.controls['customFieldFinance'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.financeField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsNumber" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              AddWallet Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldAddwallet" size="small" placeholder="Select Field"
                [ngClass]="{
                  error:
                  myForm.controls['customFieldAddwallet'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.addWalletField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
        </div>
      </form>
      <!-- <div *ngIf="myForm.invalid && !customValidation" class="row-input">
        <div class="lable">
        </div>
        <div class="value message-error" style="text-align: left;">
          Validation Error
        </div>
      </div> -->
      <div class="row-input">
        <div class="lable">
        </div>
        <div class="value">
          <div class="pos-r full-width">
            <button (click)="clear()" class="cust-button m-r-15" nbButton status="gray">
              Clear
            </button>
            <button *ngIf="!id && !noCoupons" (click)="create()" class="cust-button" nbButton status="success">
              Create
            </button>
            <button *ngIf="id" (click)="create()" class="cust-button" nbButton status="success">
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="cardType === 'membership' && selectedSell">
      <form *ngIf="!membershipCampaignId" [formGroup]="membershipForm">
        <div class="p-l-30 m-b-30" style="font-size: 25px">
          Campaign
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Campaign Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': membershipForm.controls['campaignName'].invalid && !customValidation}"
                  formControlName="campaignName" type="text" [(ngModel)]="dataCampaign.name" nbInput fullWidth
                  fieldSize="small" placeholder="">
                <div *ngIf="membershipForm.controls['campaignName'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Description
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <textarea [ngClass]="{'error': membershipForm.controls['description'].invalid && !customValidation}"
                  formControlName="description" [(ngModel)]="dataCampaign.description" nbInput fullWidth
                  placeholder="Textarea"></textarea>
                <div *ngIf="membershipForm.controls['description'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Template
            </div>
            <div class="value">
              <div *ngIf="membership.length" class="pos-r full-width">
                <nb-select [ngClass]="{'error': membershipForm.controls['template'].invalid && !customValidation}"
                  formControlName="template" #selectTemplate size="small" placeholder="Select Template"
                  [(selected)]="dataCampaign.card_id">
                  <nb-option *ngFor="let item of membership" [value]="item.id">
                    {{ item.template_name }}
                  </nb-option>
                </nb-select>
              </div>
              <div *ngIf="membershipForm.controls['template'].invalid && !customValidation" class="error-lable">
                Field error (make your choice)
              </div>
              <div *ngIf="noMembership" class="error-lable fs-16">
                Please create Membership Template First
                <a [routerLink]="[ '/main/templates/create-cards' ]" class="c-p">
                  (click here)
                </a>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Stamp Card
        </div>
        <div class="p-l-60">

        </div> -->
        <div *ngIf="isApi" class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Membership field
          <div style="font-size: small; padding-top: 5px;">
            (custom field triggers update to membership status)
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-60">
          <div class="row-input">
            <div class="lable p-t-0">
              Manychat CustomField Redeem
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFields_redeem" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  membershipForm.controls['customFields_redeem'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.selectedCustomField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable p-t-0">
              Manychat CustomField Status
            </div>
            <div class="value">
              <div class="pos-r full-width">
              <nb-select
                formControlName="customFields_status" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  membershipForm.controls['customFields_status'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.memCard_status_customField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              AddWallet Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldAddwallet" size="small" placeholder="Select Field"
                [ngClass]="{
                  error:
                  membershipForm.controls['customFieldAddwallet'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.addWalletField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="row-input">
        <div class="lable">
        </div>
        <div class="value">
          <div *ngIf="!membershipCampaignId" class="pos-r full-width">
            <button (click)="clear()" class="cust-button m-r-15" nbButton status="gray">
              Clear
            </button>
            <button *ngIf="!id && !noMembership" (click)="create()" class="cust-button" nbButton status="success">
              Create
            </button>
            <button *ngIf="id" (click)="create()" class="cust-button" nbButton status="success">
              Update
            </button>
          </div>
          <div *ngIf="membershipCampaignId" class="pos-r full-width">
            <div class="error-lable fs-16">
              You have already created membership card campaign
              <a [routerLink]="[ '/main/campaign-main/details/' + membershipCampaignId]" class="c-p">
                (click here)
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="cardType === 'loyalty' && selectedSell">
      <form *ngIf="dataCampaign.campaign_type == 5 && !loyaltyCampaignId" [formGroup]="loyaltyForm">
        <div class="p-l-30 m-b-30" style="font-size: 25px">
          Campaign
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Campaign Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': loyaltyForm.controls['campaignName'].invalid && !customValidation}"
                  formControlName="campaignName" type="text" [(ngModel)]="dataCampaign.name" nbInput fullWidth
                  fieldSize="small" placeholder="">
                <div *ngIf="loyaltyForm.controls['campaignName'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Description
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <textarea [ngClass]="{'error': loyaltyForm.controls['description'].invalid && !customValidation}"
                  formControlName="description" [(ngModel)]="dataCampaign.description" nbInput fullWidth
                  placeholder="Textarea"></textarea>
                <div *ngIf="loyaltyForm.controls['description'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Template
            </div>
            <div class="value">
              <div *ngIf="loyalty.length" class="pos-r full-width">
                <nb-select [ngClass]="{'error': loyaltyForm.controls['template'].invalid && !customValidation}"
                  formControlName="template" #selectTemplate size="small" placeholder="Select Template"
                  [(selected)]="dataCampaign.card_id">
                  <nb-option *ngFor="let item of loyalty" [value]="item.id">
                    {{ item.template_name }}
                  </nb-option>
                </nb-select>
              </div>
              <div *ngIf="loyaltyForm.controls['template'].invalid && !customValidation" class="error-lable">
                Field error (make your choice)
              </div>
              <div *ngIf="noLoyalty" class="error-lable fs-16">
                Please create Loyalty/Stamp Template First
                <a [routerLink]="[ '/main/templates/create-cards' ]" class="c-p">
                  (click here)
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Loyalty Points
        </div>
        <div class="p-l-60">
          <div class="row-input" style="display: none !important;">
            <div class="lable">
              Select Currency
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select [ngClass]="{'error': loyaltyForm.controls['currency'].invalid && !customValidation}" formControlName="currency" [(ngModel)]="brand_currency" placeholder="" fullWidth fieldSize="small" style="width: 160px;">
                  <nb-option value="$">USD ($)</nb-option>
                  <nb-option value="€">EUR (€)</nb-option>
                  <nb-option value="£">GBP (£)</nb-option>
                  <nb-option value="$">AUD ($)</nb-option>
                  <nb-option value="$">CAD ($)</nb-option>
                  <nb-option value="R$">BRL (R$)</nb-option>
                  <nb-option value="HK$">HKD (HK$)</nb-option>
                  <nb-option value="лв">BGN (лв)</nb-option>
                  <nb-option value="₺">TRY (₺)</nb-option>
                  <nb-option value="د.إ">AED (د.إ)</nb-option>
                  <nb-option value="CHF">CHF (CHF)</nb-option>
                  <nb-option value="kr">SEK (kr)</nb-option>
                  <nb-option value="NT$">NT (NT$)</nb-option>
                  <nb-option value="R">ZAR (R)</nb-option>
                  <nb-option value="$">SGD ($)</nb-option>
                  <nb-option value="₩">KRW (₩)</nb-option>
                  <nb-option value="Rs">LKR (Rs)</nb-option>
                  <nb-option value="kr">DKK (kr)</nb-option>
                  <nb-option value="Rs">PKR (Rs)</nb-option>
                  <nb-option value="₾">GEL (₾)</nb-option>
                  <nb-option value="₽">RUB (₽)</nb-option>
                  <nb-option value="zł">PLN (zł)</nb-option>
                  <nb-option value="kr">SEK (kr)</nb-option>
                  <nb-option value="¥">CNY (¥)</nb-option>
                  <nb-option value="kr">NOK (kr)</nb-option>
                  <nb-option value="₹">INR (₹)</nb-option>
                  <nb-option value="$">NZD ($)</nb-option>
                  <nb-option value="RM">MYR (RM)</nb-option>
                  <nb-option value="฿">THB (฿)</nb-option>
                  <nb-option value="₫">VND (₫)</nb-option>
                </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable" style="min-width: 100px !important; width: 100px !important;">
              1 <span class="p-l-5 p-r-5">{{ brand_currency }}</span> equals
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': loyaltyForm.controls['points'].invalid && !customValidation}"
                  formControlName="points" [(ngModel)]="dataCampaign.points" placeholder="0.01"
                  class="small m-r-5" type="number" nbInput fullWidth fieldSize="small" (input)="checkPoints($event.target.value)"
                  style="width: 120px !important; padding: 10px !important;">
                Points
                <div *ngIf="loyaltyForm.controls['points'].invalid && !customValidation" class="error-lable">
                  set points
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Points field
          <div style="font-size: small; padding-top: 5px;">
            (custom field triggers update to points)
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-60">
          <div class="row-input">
            <div class="lable p-t-0">
              Manychat CustomField
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFields" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  loyaltyForm.controls['customFields'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.selectedCustomField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsNumber" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Finance Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldFinance" size="small" placeholder="Select Finance Field"
                [ngClass]="{
                  error:
                  loyaltyForm.controls['customFieldFinance'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.financeField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsNumber" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              AddWallet Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldAddwallet" size="small" placeholder="Select Field"
                [ngClass]="{
                  error:
                  loyaltyForm.controls['customFieldAddwallet'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.addWalletField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
        </div>
      </form>
      <form *ngIf="dataCampaign.campaign_type == 6 && !stampCampaignId" [formGroup]="stampForm">
        <div class="p-l-30 m-b-30" style="font-size: 25px">
          Campaign
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Campaign Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': stampForm.controls['campaignName'].invalid && !customValidation}"
                  formControlName="campaignName" type="text" [(ngModel)]="dataCampaign.name" nbInput fullWidth
                  fieldSize="small" placeholder="">
                <div *ngIf="stampForm.controls['campaignName'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Description
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <textarea [ngClass]="{'error': stampForm.controls['description'].invalid && !customValidation}"
                  formControlName="description" [(ngModel)]="dataCampaign.description" nbInput fullWidth
                  placeholder="Textarea"></textarea>
                <div *ngIf="stampForm.controls['description'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Template
            </div>
            <div class="value">
              <div *ngIf="loyalty.length" class="pos-r full-width">
                <nb-select [ngClass]="{'error': stampForm.controls['template'].invalid && !customValidation}"
                  formControlName="template" #selectTemplate size="small" placeholder="Select Template"
                  [(selected)]="dataCampaign.card_id">
                  <nb-option *ngFor="let item of loyalty" [value]="item.id">
                    {{ item.template_name }}
                  </nb-option>
                </nb-select>
              </div>
              <div *ngIf="stampForm.controls['template'].invalid && !customValidation" class="error-lable">
                Field error (make your choice)
              </div>
              <div *ngIf="noLoyalty" class="error-lable fs-16">
                Please create Loyalty/Stamp Template First
                <a [routerLink]="[ '/main/templates/create-cards' ]" class="c-p">
                  (click here)
                </a>
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Stamp Card
        </div>
        <div class="p-l-60">

        </div> -->
        <div *ngIf="isApi" class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Stamp field
          <div style="font-size: small; padding-top: 5px;">
            (custom field triggers update to stamps)
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-60">
          <div class="row-input">
            <div class="lable p-t-0">
              Manychat CustomField
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFields" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  stampForm.controls['customFields'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.selectedCustomField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsNumber" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
              <div class="lable">
                Finance Field
              </div>
              <div class="value">
                <div class="pos-r full-width">
                  <nb-select
                  formControlName="customFieldFinance" size="small" placeholder="Select Finance Field"
                  [ngClass]="{
                    error:
                    stampForm.controls['customFieldFinance'].invalid &&
                    !customValidation
                  }"
                  [(ngModel)]="dataCampaign.financeField"
                  #selectCustomField
                  >
                  <nb-option value="">--Select Custom Fields--</nb-option>
                  <nb-option *ngFor="let customField of customFieldsNumber" [value]="customField.name">
                    {{customField.name}}
                  </nb-option>
                </nb-select>
                </div>
              </div>
            </div>
            <div class="row-input">
              <div class="lable">
                AddWallet Field
              </div>
              <div class="value">
                <div class="pos-r full-width">
                  <nb-select
                  formControlName="customFieldAddwallet" size="small" placeholder="Select Field"
                  [ngClass]="{
                    error:
                    stampForm.controls['customFieldAddwallet'].invalid &&
                    !customValidation
                  }"
                  [(ngModel)]="dataCampaign.addWalletField"
                  #selectCustomField
                  >
                  <nb-option value="">--Select Custom Fields--</nb-option>
                  <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                    {{customField.name}}
                  </nb-option>
                </nb-select>
                </div>
              </div>
            </div>
        </div>
      </form>
      <div class="row-input">
        <div class="lable">
        </div>
        <div class="value">
          <div *ngIf="dataCampaign.campaign_type == 5 && !loyaltyCampaignId" class="pos-r full-width">
            <button (click)="clear()" class="cust-button m-r-15" nbButton status="gray">
              Clear
            </button>
            <button *ngIf="!id && !noLoyalty" (click)="create()" class="cust-button" nbButton status="success">
              Create
            </button>
            <button *ngIf="id" (click)="create()" class="cust-button" nbButton status="success">
              Update
            </button>
          </div>
          <div *ngIf="dataCampaign.campaign_type == 5 && loyaltyCampaignId" class="pos-r full-width">
            <div class="error-lable fs-16">
              You have already created loyalty card campaign
              <a [routerLink]="[ '/main/campaign-main/details/' + loyaltyCampaignId]" class="c-p">
                (click here)
              </a>
            </div>
          </div>
          <div *ngIf="dataCampaign.campaign_type == 6 && !stampCampaignId" class="pos-r full-width">
            <button (click)="clear()" class="cust-button m-r-15" nbButton status="gray">
              Clear
            </button>
            <button *ngIf="!id && !noLoyalty" (click)="create()" class="cust-button" nbButton status="success">
              Create
            </button>
            <button *ngIf="id" (click)="create()" class="cust-button" nbButton status="success">
              Update
            </button>
          </div>
          <div *ngIf="dataCampaign.campaign_type == 6 && stampCampaignId" class="pos-r full-width">
            <div class="error-lable fs-16">
              You have already created stamp card campaign
              <a [routerLink]="[ '/main/campaign-main/details/' + stampCampaignId]" class="c-p">
                (click here)
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="cardType === 'ticket'  && selectedSell">
      <form [formGroup]="ticketForm">
        <div class="p-l-30 m-b-30" style="font-size: 25px">
          Campaign
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Campaign Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': ticketForm.controls['campaignName'].invalid && !customValidation}"
                  formControlName="campaignName" type="text" [(ngModel)]="dataCampaign.name" nbInput fullWidth
                  fieldSize="small" placeholder="">
                <div *ngIf="ticketForm.controls['campaignName'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Description
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <textarea [ngClass]="{'error': ticketForm.controls['description'].invalid && !customValidation}"
                  formControlName="description" [(ngModel)]="dataCampaign.description" nbInput fullWidth
                  placeholder="Textarea"></textarea>
                <div *ngIf="ticketForm.controls['description'].invalid && !customValidation" class="error-lable">
                  Field error (must have at least 1 character)
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Template
            </div>
            <div class="value">
              <div *ngIf="tickets.length" class="pos-r full-width">
                <nb-select [ngClass]="{'error': ticketForm.controls['template'].invalid && !customValidation}"
                  formControlName="template" #selectTemplate size="small" placeholder="Select Template"
                  [(selected)]="dataCampaign.card_id">
                  <nb-option *ngFor="let item of tickets" [value]="item.id">
                    {{ item.template_name }}
                  </nb-option>
                </nb-select>
              </div>
              <div *ngIf="ticketForm.controls['template'].invalid && !customValidation" class="error-lable">
                Field error (make your choice)
              </div>
              <div *ngIf="noTickets" class="error-lable fs-16">
                Please create Tickets Template First
                <a [routerLink]="[ '/main/templates/create-cards' ]" class="c-p">
                  (click here)
                </a>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              Start Date
            </div>
            <div class="value df ai-c">
              <div (clickOutside)="showDatePicker = false" class="pos-r m-r-34">
                <input [ngClass]="{'error': !dataCampaign.startDate && !customValidation}" formControlName="startDate"
                  class="small" (focus)="showDatePicker = true" [(ngModel)]="dataCampaign.startDate" type="text" nbInput
                  fullWidth fieldSize="small" placeholder="">
                <div *ngIf="!dataCampaign.startDate && !customValidation" class="error-lable">
                  Field error (make your choice)
                </div>
                <nb-calendar *ngIf="showDatePicker" (dateChange)="dateStartChange($event);" [(date)]="dateStart">
                </nb-calendar>
              </div>
              <div class="pos-r df">
                <div class="m-r-13 p-t-10">
                  Time
                </div>
                <div class="pos-r">
                  <input [ngClass]="{'error': ticketForm.controls['time'].invalid && !customValidation}"
                    formControlName="time" type="text" [(ngModel)]="dataCampaign.time" nbInput fullWidth
                    fieldSize="small" placeholder="08:00 AM">
                  <div *ngIf="ticketForm.controls['time'].invalid && !customValidation" class="error-lable">
                    enter time in format (08:00 AM)
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Ticket
        </div>
        <div class="p-l-60">
          <div class="row-input">
            <div class="lable">
              Event Name
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <input [ngClass]="{'error': ticketForm.controls['event_name'].invalid && !customValidation}"
                  formControlName="event_name" [(ngModel)]="dataCampaign.event_name"
                  type="text" nbInput fullWidth fieldSize="small"
                  style="background-repeat: no-repeat; background-position: right;">
                <div *ngIf="ticketForm.controls['event_name'].invalid && !customValidation" class="error-lable">
                  Enter event name
                </div>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div *ngIf="dataCampaign.campaign_type == 8" class="lable">
              Venue
            </div>
            <div *ngIf="dataCampaign.campaign_type == 9" class="lable">
              Webinar Access Link
            </div>
            <div class="value">
              <div class="pos-r">
                <input *ngIf="dataCampaign.campaign_type == 8" [ngClass]="{'error': ticketForm.controls['venue'].invalid && !customValidation}"
                formControlName="venue" [(ngModel)]="dataCampaign.venue" class="color-link" type="text" nbInput fullWidth fieldSize="small" placeholder="Search Location"
                #location id='location' (keydown.enter)="$event.preventDefault()" autocorrect="off" autocapitalize="off" spellcheck="off">
                <div *ngIf="dataCampaign.campaign_type == 8 && ticketForm.controls['venue'].invalid && !customValidation" class="error-lable">
                  Enter Venue of Event
                </div>
                <input *ngIf="dataCampaign.campaign_type == 9" [ngClass]="{'error': ticketForm.controls['venue'].invalid && !customValidation}"
                formControlName="venue" [(ngModel)]="dataCampaign.venue" class="color-link" type="text" nbInput fullWidth fieldSize="small" placeholder="">
                <div *ngIf="dataCampaign.campaign_type == 9 && ticketForm.controls['venue'].invalid && !customValidation" class="error-lable">
                  Enter Link of Webinar
                </div>
              </div>
            </div>
          </div>
          <div class="row-input" *ngIf="dataCampaign.campaign_type == 8">
            <div class="lable">
            </div>
            <div class="value">
              <agm-map [latitude]="latitude" [longitude]="longitude" [zoom]="zoom">
                <agm-marker [latitude]="latitude" [longitude]="longitude" [markerDraggable]="true"
                  (dragEnd)="markerDragEnd($event)"></agm-marker>
              </agm-map>

              <!-- <h5>Address: {{address}}</h5>
              <div>Latitude: {{latitude}}</div>
              <div>Longitude: {{longitude}}</div> -->
            </div>
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-30 m-b-30 p-t-30" style="font-size: 25px; border-top: 2px solid #ebeff5;">
          Redemption
          <div style="font-size: small; padding-top: 5px;">
            (custom field triggers redemption flow)
          </div>
        </div>
        <div *ngIf="isApi" class="p-l-60">
          <div class="row-input" *ngIf="dataCampaign.campaign_type == 8">
            <div class="lable p-t-0">
              Manychat CustomField
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFields" size="small" placeholder="Select Custom Fields"
                [ngClass]="{
                  error:
                  ticketForm.controls['customFields'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.selectedCustomField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
          <div class="row-input">
            <div class="lable">
              AddWallet Field
            </div>
            <div class="value">
              <div class="pos-r full-width">
                <nb-select
                formControlName="customFieldAddwallet" size="small" placeholder="Select Field"
                [ngClass]="{
                  error:
                  ticketForm.controls['customFieldAddwallet'].invalid &&
                  !customValidation
                }"
                [(ngModel)]="dataCampaign.addWalletField"
                #selectCustomField
                >
                <nb-option value="">--Select Custom Fields--</nb-option>
                <nb-option *ngFor="let customField of customFieldsBoolean" [value]="customField.name">
                  {{customField.name}}
                </nb-option>
              </nb-select>
              </div>
            </div>
          </div>
        </div>
      </form>
      <!-- <div *ngIf="myForm.invalid && !customValidation" class="row-input">
        <div class="lable">
        </div>
        <div class="value message-error" style="text-align: left;">
          Validation Error
        </div>
      </div> -->
      <div class="row-input">
        <div class="lable">
        </div>
        <div class="value">
          <div class="pos-r full-width">
            <button (click)="clear()" class="cust-button m-r-15" nbButton status="gray">
              Clear
            </button>
            <button *ngIf="!id && !noTickets" (click)="create()" class="cust-button" nbButton status="success">
              Create
            </button>
            <button *ngIf="id" (click)="create()" class="cust-button" nbButton status="success">
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>

<!-- <app-dialog-upgrade></app-dialog-upgrade> -->
